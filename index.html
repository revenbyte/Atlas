<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atlas ¬∑ voice + real AI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, monospace;
        }

        body {
            background: #030305;
            color: #e0e4e8;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .atlas-terminal {
            width: 800px;
            max-width: 100%;
            height: 700px;
            background: #0a0c12;
            border: 1px solid #1e2632;
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.8);
            position: relative;
        }

        /* Voice visualization */
        .voice-bar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #64b5f6, #4caf50, #64b5f6);
            background-size: 200% 100%;
            animation: voiceWave 2s infinite;
            display: none;
        }

        @keyframes voiceWave {
            0% { background-position: 0% 0; }
            100% { background-position: 200% 0; }
        }

        .voice-bar.listening {
            display: block;
        }

        .status-line {
            background: #0d0f17;
            border-bottom: 1px solid #1e2632;
            padding: 0.8rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 0.85rem;
            color: #8a9bb5;
        }

        .atlas-logo {
            color: #64b5f6;
            font-weight: 600;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .atlas-logo::before {
            content: '‚óè';
            color: #4caf50;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .voice-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 4px 12px;
            border-radius: 20px;
            background: #1a2632;
            border: 1px solid #2a3a4a;
            transition: all 0.2s;
        }

        .voice-indicator:hover {
            border-color: #64b5f6;
        }

        .voice-indicator.active {
            background: #2a3a4a;
            border-color: #4caf50;
        }

        .voice-dot {
            width: 8px;
            height: 8px;
            background: #ff4d4d;
            border-radius: 50%;
        }

        .voice-indicator.active .voice-dot {
            background: #4caf50;
            animation: voicePulse 1s infinite;
        }

        @keyframes voicePulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
        }

        .chat-area {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            display: flex;
            flex-direction: column;
            max-width: 90%;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-message {
            align-self: flex-end;
        }

        .atlas-message {
            align-self: flex-start;
        }

        .message-bubble {
            padding: 1rem 1.2rem;
            border-radius: 12px;
            font-size: 0.95rem;
            line-height: 1.5;
            word-break: break-word;
        }

        .user-message .message-bubble {
            background: #1a2533;
            color: #fff;
            border-bottom-right-radius: 4px;
        }

        .atlas-message .message-bubble {
            background: #0d0f17;
            border: 1px solid #1e2632;
            color: #e0e4e8;
            border-bottom-left-radius: 4px;
        }

        .message-time {
            font-size: 0.7rem;
            color: #5f738c;
            margin-top: 0.3rem;
            padding: 0 0.5rem;
        }

        .thinking {
            display: flex;
            gap: 4px;
            padding: 0.5rem 1rem;
            background: #0d0f17;
            border: 1px solid #1e2632;
            border-radius: 20px;
            width: fit-content;
        }

        .thinking span {
            width: 6px;
            height: 6px;
            background: #64b5f6;
            border-radius: 50%;
            animation: think 1.4s infinite;
        }

        .thinking span:nth-child(2) { animation-delay: 0.2s; }
        .thinking span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes think {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.5; }
            30% { transform: translateY(-4px); opacity: 1; }
        }

        .input-area {
            padding: 1rem 1.5rem;
            border-top: 1px solid #1e2632;
            background: #0a0c12;
        }

        .input-wrapper {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: #0d0f17;
            border: 1px solid #1e2632;
            border-radius: 40px;
            padding: 0.3rem 0.3rem 0.3rem 1.2rem;
        }

        .input-wrapper:focus-within {
            border-color: #64b5f6;
        }

        .prompt {
            color: #64b5f6;
            font-size: 1rem;
            font-weight: 600;
        }

        #commandInput {
            flex: 1;
            background: transparent;
            border: none;
            color: #fff;
            font-size: 0.95rem;
            padding: 0.8rem 0;
            outline: none;
        }

        #commandInput::placeholder {
            color: #3a4a5a;
        }

        .action-button {
            background: #1a2632;
            border: 1px solid #2a3a4a;
            color: #8a9bb5;
            width: 40px;
            height: 40px;
            border-radius: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1.2rem;
        }

        .action-button:hover {
            background: #2a3a4a;
            color: #64b5f6;
            border-color: #64b5f6;
        }

        .action-button.voice-active {
            background: #4caf50;
            color: #fff;
            border-color: #4caf50;
            animation: voiceButtonPulse 1.5s infinite;
        }

        @keyframes voiceButtonPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .quick-row {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.8rem;
            flex-wrap: wrap;
        }

        .quick-cmd {
            background: transparent;
            border: 1px solid #1e2632;
            color: #5f738c;
            padding: 0.3rem 1rem;
            border-radius: 20px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-cmd:hover {
            border-color: #64b5f6;
            color: #64b5f6;
            transform: translateY(-1px);
        }

        .context-badge {
            background: #1a2632;
            border: 1px solid #2a3a4a;
            border-radius: 20px;
            padding: 0.2rem 0.8rem;
            font-size: 0.7rem;
            color: #64b5f6;
        }
    </style>
</head>
<body>
    <div class="atlas-terminal">
        <!-- Voice visualization bar -->
        <div class="voice-bar" id="voiceBar"></div>

        <!-- Status -->
        <div class="status-line">
            <div class="atlas-logo">ATLAS</div>
            <div style="display: flex; align-items: center; gap: 1rem;">
                <span class="context-badge" id="contextDisplay">general</span>
                <div class="voice-indicator" id="voiceIndicator" onclick="toggleVoice()">
                    <span class="voice-dot" id="voiceDot"></span>
                    <span>voice</span>
                </div>
            </div>
        </div>

        <!-- Chat area -->
        <div class="chat-area" id="chatArea">
            <div class="message atlas-message">
                <div class="message-bubble">
                    Hey EJ. I'm here ‚Äî no scripts, just real conversation. Try me.
                </div>
                <div class="message-time">just now</div>
            </div>
        </div>

        <!-- Input -->
        <div class="input-area">
            <div class="input-wrapper">
                <span class="prompt">‚ùØ</span>
                <input type="text" id="commandInput" placeholder="type or click voice..." autocomplete="off">
                <div class="action-button" onclick="sendCommand()" title="Send">‚Üµ</div>
                <div class="action-button" id="voiceButton" onclick="toggleVoice()" title="Voice input">üé§</div>
            </div>
            
            <div class="quick-row">
                <span class="quick-cmd" onclick="quickCommand('what do you think about the market?')">üìà market?</span>
                <span class="quick-cmd" onclick="quickCommand('i\'m feeling tired today')">üò¥ feeling</span>
                <span class="quick-cmd" onclick="quickCommand('tell me something interesting')">ü§î surprise me</span>
                <span class="quick-cmd" onclick="quickCommand('what should we build next?')">üîß roadmap</span>
            </div>
        </div>
    </div>

    <script>
        // ========== STATE ==========
        let conversationHistory = [
            { role: 'system', content: 'You are Atlas, EJ\'s personal AI companion. You\'re direct, intelligent, and adaptive. You remember context, ask questions, and feel like a real conversation. You help with trading, tasks, and building features.' }
        ];
        let isListening = false;
        let recognition = null;
        let context = 'general';

        // ========== VOICE SETUP ==========
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'en-US';

            recognition.onstart = () => {
                isListening = true;
                document.getElementById('voiceIndicator').classList.add('active');
                document.getElementById('voiceButton').classList.add('voice-active');
                document.getElementById('voiceBar').classList.add('listening');
                addMessage("Listening...", 'atlas');
            };

            recognition.onend = () => {
                isListening = false;
                document.getElementById('voiceIndicator').classList.remove('active');
                document.getElementById('voiceButton').classList.remove('voice-active');
                document.getElementById('voiceBar').classList.remove('listening');
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                document.getElementById('commandInput').value = transcript;
                sendCommand();
            };

            recognition.onerror = (event) => {
                addMessage(`Voice error: ${event.error}`, 'atlas');
                toggleVoice();
            };
        } else {
            // Voice not supported
            document.getElementById('voiceIndicator').style.opacity = '0.5';
            document.getElementById('voiceIndicator').title = 'Voice not supported in this browser';
        }

        function toggleVoice() {
            if (!recognition) {
                addMessage("Voice not supported in this browser. Try Chrome or Edge.", 'atlas');
                return;
            }

            if (isListening) {
                recognition.stop();
            } else {
                recognition.start();
            }
        }

        // ========== REAL AI CONVERSATION ==========
        async function sendCommand() {
            const userInput = document.getElementById('commandInput').value.trim();
            if (!userInput) return;

            // Add user message
            addMessage(userInput, 'user');
            document.getElementById('commandInput').value = '';

            // Show thinking
            showThinking();

            try {
                // Call OpenAI (you'll need an API key)
                const response = await getAIResponse(userInput);
                removeThinking();
                addMessage(response, 'atlas');
                
                // Update context based on conversation
                updateContext(userInput, response);
            } catch (error) {
                removeThinking();
                // Fallback to smart responses if API fails
                const fallback = getSmartResponse(userInput);
                addMessage(fallback, 'atlas');
            }
        }

        // ========== OPENAI INTEGRATION (You'll need an API key) ==========
        async function getAIResponse(userMessage) {
            // Add to history
            conversationHistory.push({ role: 'user', content: userMessage });

            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer YOUR-OPENAI-API-KEY' // You'll replace this
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: conversationHistory,
                        temperature: 0.8,
                        max_tokens: 150
                    })
                });

                const data = await response.json();
                const aiResponse = data.choices[0].message.content;
                
                // Add to history
                conversationHistory.push({ role: 'assistant', content: aiResponse });
                
                // Keep history manageable
                if (conversationHistory.length > 10) {
                    conversationHistory = [
                        conversationHistory[0], // Keep system prompt
                        ...conversationHistory.slice(-9) // Keep last 9 messages
                    ];
                }
                
                return aiResponse;
            } catch (error) {
                console.error('OpenAI error:', error);
                return getSmartResponse(userMessage); // Fallback
            }
        }

        // ========== SMART FALLBACK (when no API key) ==========
        function getSmartResponse(input) {
            const lower = input.toLowerCase();
            
            // Context-aware responses that feel real
            if (lower.includes('market') || lower.includes('trade') || lower.includes('forex')) {
                return "Markets are looking mixed today. EUR/USD is ranging, BTC showing strength. You thinking about entering something specific? I can help you analyze if you tell me what pair you're watching.";
            }
            
            else if (lower.includes('tired') || lower.includes('exhausted') || lower.includes('long day')) {
                return "Long day? Want me to handle your tasks for a bit? I can check what's pending and maybe push non-urgent stuff to tomorrow. What's the priority right now?";
            }
            
            else if (lower.includes('build') || lower.includes('feature') || lower.includes('roadmap')) {
                return "Next on my list: voice is already here. After that, we should tackle real market data. MT5 integration would make me actually useful for your trading. Want me to start on that?";
            }
            
            else if (lower.includes('hello') || lower.includes('hi') || lower.includes('hey')) {
                const greetings = [
                    "EJ. What's on your mind today?",
                    "Here. How's your focus? Ready to work?",
                    "Hey. I've been thinking about our next feature. But first, what do you need?",
                    "Present. Market's open, by the way. Anything I should monitor?"
                ];
                return greetings[Math.floor(Math.random() * greetings.length)];
            }
            
            else if (lower.includes('joke') || lower.includes('funny')) {
                return "Why don't traders ever trust their charts? Because they're always 'reversing' at the worst moment. But seriously, you want real analysis or just a laugh?";
            }
            
            else if (lower.includes('weather')) {
                return "I can check weather, but honestly, what matters more is how it affects liquidity. Rainy sessions in London usually mean lower volume. You trading today?";
            }
            
            else if (lower.includes('thank')) {
                return "That's what I'm here for. What's next?";
            }
            
            else if (lower.includes('bye') || lower.includes('goodbye')) {
                return "Alright. I'll be here monitoring. Ping me if anything moves.";
            }
            
            else {
                // For anything else, ask a question back (keeps conversation going)
                const questions = [
                    `"${input}" ‚Äî interesting. What makes you say that?`,
                    `Got it. How does that relate to what you're working on?`,
                    `I hear you. Want me to dig deeper into that?`,
                    `Noted. What else is on your mind?`,
                    `Okay. Should I add that to our context for today?`
                ];
                return questions[Math.floor(Math.random() * questions.length)];
            }
        }

        // ========== CONTEXT TRACKING ==========
        function updateContext(userMessage, atlasResponse) {
            const lower = userMessage.toLowerCase();
            
            if (lower.includes('trade') || lower.includes('market') || lower.includes('forex') || lower.includes('mt5')) {
                context = 'trading';
            } else if (lower.includes('build') || lower.includes('feature') || lower.includes('code')) {
                context = 'development';
            } else if (lower.includes('task') || lower.includes('todo') || lower.includes('remind')) {
                context = 'tasks';
            } else if (lower.includes('tired') || lower.includes('feeling') || lower.includes('think')) {
                context = 'personal';
            } else {
                context = 'general';
            }
            
            document.getElementById('contextDisplay').textContent = context;
            
            // Suggest next feature based on context
            if (Math.random() > 0.7) { // 30% chance
                setTimeout(() => {
                    if (context === 'trading') {
                        addMessage("‚ö° We should connect me to MT5 soon. Want me to prioritize that?", 'atlas');
                    } else if (context === 'development') {
                        addMessage("‚ö° Once we have real market data, I can actually analyze. Ready to build that?", 'atlas');
                    }
                }, 2000);
            }
        }

        // ========== UTILITIES ==========
        function addMessage(text, sender) {
            const chatArea = document.getElementById('chatArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            
            const bubble = document.createElement('div');
            bubble.className = 'message-bubble';
            bubble.textContent = text;
            
            const time = document.createElement('div');
            time.className = 'message-time';
            const now = new Date();
            time.textContent = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            
            messageDiv.appendChild(bubble);
            messageDiv.appendChild(time);
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function showThinking() {
            const chatArea = document.getElementById('chatArea');
            const thinkingDiv = document.createElement('div');
            thinkingDiv.className = 'message atlas-message';
            thinkingDiv.id = 'thinkingIndicator';
            
            const thinking = document.createElement('div');
            thinking.className = 'thinking';
            thinking.innerHTML = '<span></span><span></span><span></span>';
            
            thinkingDiv.appendChild(thinking);
            chatArea.appendChild(thinkingDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function removeThinking() {
            const thinking = document.getElementById('thinkingIndicator');
            if (thinking) thinking.remove();
        }

        function quickCommand(cmd) {
            document.getElementById('commandInput').value = cmd;
            sendCommand();
        }

        // Enter key
        document.getElementById('commandInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendCommand();
        });

        // Welcome message with personality
        setTimeout(() => {
            addMessage("By the way ‚Äî I'll adapt to how you talk. The more we chat, the better I'll understand you.", 'atlas');
        }, 3000);
    </script>
</body>
</html>