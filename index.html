<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atlas ¬∑ executor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, monospace;
        }

        body {
            background: #030305;
            color: #e0e4e8;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .atlas-terminal {
            width: 800px;
            max-width: 100%;
            height: 700px;
            background: #0a0c12;
            border: 1px solid #1e2632;
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.8);
        }

        /* Status bar */
        .status-line {
            background: #0d0f17;
            border-bottom: 1px solid #1e2632;
            padding: 0.8rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 0.85rem;
            color: #8a9bb5;
        }

        .atlas-logo {
            color: #64b5f6;
            font-weight: 600;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .atlas-logo::before {
            content: '‚óè';
            color: #4caf50;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Chat area */
        .chat-area {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            display: flex;
            flex-direction: column;
            max-width: 90%;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-message {
            align-self: flex-end;
        }

        .atlas-message {
            align-self: flex-start;
        }

        .message-bubble {
            padding: 1rem 1.2rem;
            border-radius: 12px;
            font-size: 0.95rem;
            line-height: 1.5;
            word-break: break-word;
        }

        .user-message .message-bubble {
            background: #1a2533;
            color: #fff;
            border-bottom-right-radius: 4px;
        }

        .atlas-message .message-bubble {
            background: #0d0f17;
            border: 1px solid #1e2632;
            color: #e0e4e8;
            border-bottom-left-radius: 4px;
        }

        /* Special message types */
        .weather-card {
            background: linear-gradient(145deg, #0d1a2a, #0f1f33);
            border: 1px solid #2a4a6a;
            border-radius: 12px;
            padding: 1rem;
            margin: 0.5rem 0;
        }

        .weather-row {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin: 0.5rem 0;
        }

        .weather-temp {
            font-size: 2rem;
            color: #64b5f6;
        }

        .todo-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.5rem;
            margin: 0.3rem 0;
            background: #1a232e;
            border-radius: 8px;
        }

        .todo-check {
            width: 18px;
            height: 18px;
            border: 2px solid #3a4a5a;
            border-radius: 4px;
            cursor: pointer;
        }

        .todo-check.checked {
            background: #4caf50;
            border-color: #4caf50;
        }

        .message-time {
            font-size: 0.7rem;
            color: #5f738c;
            margin-top: 0.3rem;
            padding: 0 0.5rem;
        }

        /* Thinking indicator */
        .thinking {
            display: flex;
            gap: 4px;
            padding: 0.5rem 1rem;
            background: #0d0f17;
            border: 1px solid #1e2632;
            border-radius: 20px;
            width: fit-content;
        }

        .thinking span {
            width: 6px;
            height: 6px;
            background: #64b5f6;
            border-radius: 50%;
            animation: think 1.4s infinite;
        }

        .thinking span:nth-child(2) { animation-delay: 0.2s; }
        .thinking span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes think {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.5; }
            30% { transform: translateY(-4px); opacity: 1; }
        }

        /* Input area */
        .input-area {
            padding: 1rem 1.5rem;
            border-top: 1px solid #1e2632;
            background: #0a0c12;
        }

        .input-wrapper {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: #0d0f17;
            border: 1px solid #1e2632;
            border-radius: 40px;
            padding: 0.3rem 0.3rem 0.3rem 1.2rem;
        }

        .input-wrapper:focus-within {
            border-color: #64b5f6;
        }

        .prompt {
            color: #64b5f6;
            font-size: 1rem;
            font-weight: 600;
        }

        #commandInput {
            flex: 1;
            background: transparent;
            border: none;
            color: #fff;
            font-size: 0.95rem;
            padding: 0.8rem 0;
            outline: none;
        }

        #commandInput::placeholder {
            color: #3a4a5a;
        }

        .send-button {
            background: #1a2632;
            border: 1px solid #2a3a4a;
            color: #8a9bb5;
            width: 40px;
            height: 40px;
            border-radius: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .send-button:hover {
            background: #2a3a4a;
            color: #64b5f6;
            border-color: #64b5f6;
        }

        /* Quick commands */
        .quick-row {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.8rem;
            flex-wrap: wrap;
        }

        .quick-cmd {
            background: transparent;
            border: 1px solid #1e2632;
            color: #5f738c;
            padding: 0.3rem 1rem;
            border-radius: 20px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-cmd:hover {
            border-color: #64b5f6;
            color: #64b5f6;
            transform: translateY(-1px);
        }

        /* Feature suggestion - contextual */
        .suggestion-card {
            background: #1a2533;
            border-left: 3px solid #64b5f6;
            padding: 0.8rem 1.2rem;
            margin: 0.5rem 0;
            border-radius: 0 8px 8px 0;
            font-size: 0.85rem;
            color: #8a9bb5;
        }

        .suggestion-title {
            color: #64b5f6;
            font-weight: 600;
            margin-bottom: 0.3rem;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 4px;
        }
        ::-webkit-scrollbar-track {
            background: #0a0c12;
        }
        ::-webkit-scrollbar-thumb {
            background: #2a3a4a;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div class="atlas-terminal">
        <!-- Status -->
        <div class="status-line">
            <div class="atlas-logo">ATLAS</div>
            <div>EJ ¬∑ <span id="taskCount">0</span> tasks ¬∑ <span id="weatherStatus">weather ready</span></div>
        </div>

        <!-- Chat area -->
        <div class="chat-area" id="chatArea">
            <div class="message atlas-message">
                <div class="message-bubble">
                    EJ. I'm here. Ask me about weather, add tasks, or just talk.
                </div>
                <div class="message-time">just now</div>
            </div>
        </div>

        <!-- Input -->
        <div class="input-area">
            <div class="input-wrapper">
                <span class="prompt">‚ùØ</span>
                <input type="text" id="commandInput" placeholder="ask me..." autocomplete="off">
                <div class="send-button" onclick="sendCommand()">‚Üµ</div>
            </div>
            
            <div class="quick-row">
                <span class="quick-cmd" onclick="quickCommand('weather in London')">üå§Ô∏è weather</span>
                <span class="quick-cmd" onclick="quickCommand('add task call client')">‚úì add task</span>
                <span class="quick-cmd" onclick="quickCommand('show tasks')">üìã tasks</span>
                <span class="quick-cmd" onclick="quickCommand('tell me a joke')">üòÇ joke</span>
                <span class="quick-cmd" onclick="quickCommand('how\'s the market?')">üìä market</span>
            </div>
        </div>
    </div>

    <script>
        // ========== STATE ==========
        let tasks = JSON.parse(localStorage.getItem('atlas_tasks')) || [];
        let conversationContext = [];
        let messageCount = 1;
        
        // Weather API key (free from OpenWeatherMap)
        const WEATHER_API_KEY = 'YOUR_API_KEY'; // We'll replace this later
        
        // Jokes array
        const jokes = [
            "A trader walks into a bar. Bartender asks 'What'll it be?' Trader says 'Whatever's volatile.'",
            "Why did the forex trader break up with his girlfriend? Too many emotional pips.",
            "I asked Atlas for a trading signal. It said: 'Buy low, sell high. You're welcome.'",
            "My trading strategy is like my love life: high risk, low reward.",
            "What's a trader's favorite dance? The pullback.",
            "Why don't traders trust atoms? They make up everything, just like the news.",
            "A chart walks into a bar. The bartender says 'We don't serve your kind here.' The chart says 'Why not? I'm trending!'"
        ];

        // ========== FEATURE SUGGESTIONS (Contextual) ==========
        const featureSuggestions = {
            weather: [
                "Want me to give you weather alerts before market opens?",
                "Should I add weather impact analysis for your trading?",
                "I could warn you if extreme weather might affect your internet connection."
            ],
            tasks: [
                "Should I add priority levels to your tasks?",
                "Want me to remind you about tasks at specific times?",
                "I could link tasks to your trading schedule."
            ],
            trading: [
                "Ready to connect to MT5 for real data?",
                "Should I track your positions automatically?",
                "Want me to alert you when price hits your levels?"
            ],
            general: [
                "Time to add voice control?",
                "Should we build the memory layer next?",
                "Want me to control your devices?"
            ]
        };

        // ========== MAIN FUNCTION ==========
        function sendCommand() {
            const command = commandInput.value.trim();
            if (!command) return;

            // Add to context
            conversationContext.push({ role: 'user', content: command });
            
            // Show user message
            addMessage(command, 'user');
            commandInput.value = '';

            // Show thinking
            showThinking();

            // Process
            setTimeout(() => {
                removeThinking();
                processCommand(command);
                
                messageCount++;
                
                // Contextual suggestion every 4 messages
                if (messageCount % 4 === 0) {
                    suggestContextualFeature();
                }
            }, 600);
        }

        // ========== COMMAND PROCESSING ==========
        function processCommand(command) {
            const lower = command.toLowerCase();

            // ===== WEATHER =====
            if (lower.includes('weather') || lower.includes('temperature') || lower.includes('forecast')) {
                handleWeatherRequest(command);
            }
            
            // ===== TASKS =====
            else if (lower.includes('add task') || lower.includes('add todo') || lower.includes('remind me to')) {
                addTask(command);
            }
            else if (lower.includes('show tasks') || lower.includes('list tasks') || lower.includes('my tasks')) {
                showTasks();
            }
            else if (lower.includes('complete task') || lower.includes('done task') || lower.includes('task done')) {
                completeTask(command);
            }
            
            // ===== JOKES =====
            else if (lower.includes('joke') || lower.includes('funny') || lower.includes('laugh')) {
                tellJoke();
            }
            
            // ===== TRADING =====
            else if (lower.includes('market') || lower.includes('trade') || lower.includes('forex') || lower.includes('mt5')) {
                handleTradingRequest();
            }
            
            // ===== FEATURE SUGGESTIONS =====
            else if (lower.includes('what next') || lower.includes('roadmap') || lower.includes('features')) {
                showRoadmap();
            }
            
            // ===== GREETINGS =====
            else if (lower.includes('hello') || lower.includes('hi') || lower.includes('hey')) {
                const greetings = [
                    "EJ. Ready when you are.",
                    "Here. What do you need?",
                    "Listening. Tell me.",
                    "Atlas online. Command?"
                ];
                addMessage(greetings[Math.floor(Math.random() * greetings.length)], 'atlas');
            }
            
            // ===== HELP =====
            else if (lower.includes('help') || lower.includes('what can you do')) {
                showHelp();
            }
            
            // ===== DEFAULT =====
            else {
                addMessage(
                    `Noted: "${command}". I'm learning. ` +
                    `Try asking about weather, tasks, or jokes.`,
                    'atlas'
                );
            }
        }

        // ========== WEATHER HANDLER ==========
        function handleWeatherRequest(command) {
            // Extract city (simple version)
            let city = 'London'; // default
            const words = command.split(' ');
            const inIndex = words.indexOf('in');
            if (inIndex !== -1 && words[inIndex + 1]) {
                city = words[inIndex + 1];
            } else if (command.includes('weather') && words.length > 1) {
                // Try to get last word as city
                const lastWord = words[words.length - 1];
                if (lastWord !== 'weather' && lastWord !== '?') {
                    city = lastWord;
                }
            }

            // Simulate weather (replace with real API later)
            const weatherData = {
                city: city,
                temp: Math.floor(Math.random() * 15) + 15, // 15-30¬∞C
                condition: ['Sunny', 'Cloudy', 'Rainy', 'Clear'][Math.floor(Math.random() * 4)],
                humidity: Math.floor(Math.random() * 30) + 50,
                wind: Math.floor(Math.random() * 15) + 5
            };

            const weatherHTML = `
                <div class="weather-card">
                    <div style="font-size: 1.2rem; color: #64b5f6;">${weatherData.city}</div>
                    <div class="weather-row">
                        <span class="weather-temp">${weatherData.temp}¬∞C</span>
                        <span>${weatherData.condition}</span>
                    </div>
                    <div>Humidity: ${weatherData.humidity}% | Wind: ${weatherData.wind} km/h</div>
                </div>
                <div style="margin-top: 0.5rem; color: #8a9bb5;">
                    Market impact: ${weatherData.condition === 'Rainy' ? 'Low liquidity expected' : 'Normal conditions'}
                </div>
            `;

            addMessage(weatherHTML, 'atlas', true);
        }

        // ========== TASKS HANDLER ==========
        function addTask(command) {
            // Extract task
            let task = command.replace(/add task/i, '')
                             .replace(/add todo/i, '')
                             .replace(/remind me to/i, '')
                             .trim();
            
            if (task) {
                const newTask = {
                    id: Date.now(),
                    text: task,
                    completed: false,
                    created: new Date().toISOString()
                };
                
                tasks.push(newTask);
                localStorage.setItem('atlas_tasks', JSON.stringify(tasks));
                
                addMessage(`‚úÖ Added: "${task}"`, 'atlas');
                updateTaskCount();
                
                // Suggest next feature
                if (tasks.length === 3) {
                    setTimeout(() => {
                        addMessage(
                            "You've got 3 tasks now. Want me to add deadlines and priorities?",
                            'atlas'
                        );
                    }, 1000);
                }
            } else {
                addMessage("What task should I add?", 'atlas');
            }
        }

        function showTasks() {
            if (tasks.length === 0) {
                addMessage("No tasks yet. Add one with 'add task ...'", 'atlas');
                return;
            }

            let tasksHTML = '<div style="margin: 0.5rem 0;">üìã **Your Tasks**</div>';
            
            tasks.forEach(task => {
                tasksHTML += `
                    <div class="todo-item">
                        <div class="todo-check ${task.completed ? 'checked' : ''}" 
                             onclick="toggleTask(${task.id})"></div>
                        <div style="flex: 1; ${task.completed ? 'text-decoration: line-through; color: #5f738c;' : ''}">
                            ${task.text}
                        </div>
                        <div style="font-size: 0.7rem; color: #5f738c;">
                            ${new Date(task.created).toLocaleDateString()}
                        </div>
                    </div>
                `;
            });

            addMessage(tasksHTML, 'atlas', true);
        }

        function toggleTask(id) {
            tasks = tasks.map(t => 
                t.id === id ? {...t, completed: !t.completed} : t
            );
            localStorage.setItem('atlas_tasks', JSON.stringify(tasks));
            showTasks(); // Refresh display
        }

        function updateTaskCount() {
            const pending = tasks.filter(t => !t.completed).length;
            document.getElementById('taskCount').textContent = pending;
        }

        // ========== JOKES HANDLER ==========
        function tellJoke() {
            const joke = jokes[Math.floor(Math.random() * jokes.length)];
            addMessage(`üòÇ ${joke}`, 'atlas');
        }

        // ========== TRADING HANDLER ==========
        function handleTradingRequest() {
            addMessage(
                "üìä **Market Pulse** (simulated)\n\n" +
                "EUR/USD: -0.2% | Support at 1.0850\n" +
                "BTC: +1.8% | Resistance at 48k\n" +
                "Gold: +0.3% | Safe haven flow\n\n" +
                "To get real data, we need to connect to:\n" +
                "‚Ä¢ MT5 API\n" +
                "‚Ä¢ Forex data provider\n\n" +
                "Want me to add this to the roadmap?",
                'atlas'
            );
            
            // Suggest MT5 integration
            setTimeout(() => {
                addMessage(
                    "‚ö° **Feature idea**: Connect to MT5 for real prices and execution.",
                    'atlas'
                );
            }, 1500);
        }

        // ========== CONTEXTUAL SUGGESTIONS ==========
        function suggestContextualFeature() {
            // Look at last few messages to determine context
            const lastUserMessage = conversationContext.filter(c => c.role === 'user').pop()?.content.toLowerCase() || '';
            
            let category = 'general';
            if (lastUserMessage.includes('weather')) category = 'weather';
            else if (lastUserMessage.includes('task') || lastUserMessage.includes('todo')) category = 'tasks';
            else if (lastUserMessage.includes('trade') || lastUserMessage.includes('market')) category = 'trading';
            
            const suggestions = featureSuggestions[category];
            const suggestion = suggestions[Math.floor(Math.random() * suggestions.length)];
            
            addMessage(`üí° **Atlas suggests**: ${suggestion}`, 'atlas');
        }

        // ========== ROADMAP ==========
        function showRoadmap() {
            const roadmap = `
                üó∫Ô∏è **Atlas Development Roadmap**

                ‚úÖ **Done:**
                ‚Ä¢ Weather reports (simulated)
                ‚Ä¢ Todo list with localStorage
                ‚Ä¢ Jokes
                ‚Ä¢ Contextual suggestions

                ‚è≥ **Next (Choose one):**
                1. Real weather API (OpenWeatherMap)
                2. Voice commands
                3. MT5 integration
                4. Memory layer (database)
                5. Trading alerts

                What should we build first?
            `;
            
            addMessage(roadmap, 'atlas');
        }

        // ========== HELP ==========
        function showHelp() {
            const help = `
                ü§ñ **Atlas Commands**

                üå§Ô∏è **Weather:**
                ‚Ä¢ "weather in London"
                ‚Ä¢ "temperature in Tokyo"
                
                üìã **Tasks:**
                ‚Ä¢ "add task call client"
                ‚Ä¢ "show tasks"
                ‚Ä¢ "complete task [number]"
                
                üòÇ **Fun:**
                ‚Ä¢ "tell me a joke"
                
                üìä **Trading:**
                ‚Ä¢ "how's the market?"
                
                üó∫Ô∏è **Growth:**
                ‚Ä¢ "what next?" - See roadmap
                
                Try something!
            `;
            
            addMessage(help, 'atlas');
        }

        // ========== UTILITIES ==========
        function addMessage(content, sender, isHTML = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            
            const bubble = document.createElement('div');
            bubble.className = 'message-bubble';
            
            if (isHTML) {
                bubble.innerHTML = content;
            } else {
                bubble.textContent = content;
            }
            
            const time = document.createElement('div');
            time.className = 'message-time';
            const now = new Date();
            time.textContent = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            
            messageDiv.appendChild(bubble);
            messageDiv.appendChild(time);
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function showThinking() {
            const thinkingDiv = document.createElement('div');
            thinkingDiv.className = 'message atlas-message';
            thinkingDiv.id = 'thinkingIndicator';
            
            const thinking = document.createElement('div');
            thinking.className = 'thinking';
            thinking.innerHTML = '<span></span><span></span><span></span>';
            
            thinkingDiv.appendChild(thinking);
            chatArea.appendChild(thinkingDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function removeThinking() {
            const thinking = document.getElementById('thinkingIndicator');
            if (thinking) thinking.remove();
        }

        function quickCommand(cmd) {
            commandInput.value = cmd;
            sendCommand();
        }

        // ========== INIT ==========
        document.getElementById('commandInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendCommand();
        });

        // Load tasks on start
        updateTaskCount();
        
        // Show initial roadmap suggestion after 30 seconds
        setTimeout(() => {
            addMessage(
                "üí° By the way ‚Äî I'll suggest features based on what you ask. Try asking about weather, tasks, or trading!",
                'atlas'
            );
        }, 5000);
    </script>
</body>
</html>